@model IEnumerable<ZenithDataLib.Models.Event>

@{
    ViewBag.Title = "Home Page";
    HashSet<DayOfWeek> activeDays = new HashSet<DayOfWeek>();
}

<p>@ViewBag.Mon</p>
<p>@ViewBag.Sun</p>

<div class="jumbotron">
    <h2>Zenith Society</h2>
</div>

<table class="table">
    <tr>
        <th colspan="2">
            Events of the week
        </th>
    </tr>

    @foreach (var item in Model)
    {
        var mon = DayOfWeek.Monday;
        var sun = DayOfWeek.Sunday;
        var cur = DateTime.Now.DayOfWeek;
        int startDif = mon - cur;
        int endDif = mon - sun;
        
        if (item.IsActive && item.DateFrom.Date >= DateTime.Now.AddDays(startDif).Date && item.DateFrom.Date <= DateTime.Now.AddDays(endDif).Date)
        {
            activeDays.Add(item.DateFrom.DayOfWeek);
        }
    }

    @foreach (var day in activeDays)
    {
        ViewBag.daySwitch = true;

        foreach (var item in Model)
        {
            ViewBag.DateFrom = item.DateFrom.ToShortTimeString();
            ViewBag.DateTo = item.DateTo.ToShortTimeString();
            ViewBag.LongDate = item.DateFrom.ToLongDateString();

            if (day == item.DateFrom.DayOfWeek && item.IsActive)
            {
                if (ViewBag.daySwitch)
                {
                    <tr class="weekday">
                        <td colspan="2">
                            @ViewBag.LongDate
                        </td>
                    </tr>

                    ViewBag.daySwitch = false;
                }

                <tr>
                    <td width="30%">
                        @ViewBag.DateFrom - @ViewBag.DateTo
                    </td>
                    <td width="70%">
                        @Html.DisplayFor(modelItem => item.Activity.ActivityDescription)
                    </td>
                </tr>
            }
        }
    }

</table>